# Apache Virtual Host Configuration for MySurfLife
# File location: /etc/apache2/sites-available/mysurflife.conf
# Enable with: sudo a2ensite mysurflife.conf

<VirtualHost *:80>
    ServerName mysurflife.com
    ServerAlias www.mysurflife.com
    ServerAdmin admin@mysurflife.com

    DocumentRoot /var/www/mysurflife/public

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/mysurflife-error.log
    CustomLog ${APACHE_LOG_DIR}/mysurflife-access.log combined

    # Frontend (React static files)
    <Directory /var/www/mysurflife/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # React Router - redirect all requests to index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Backend API (FastAPI) - Reverse Proxy to localhost:8000
    ProxyPreserveHost On
    ProxyPass /api http://127.0.0.1:8000/api
    ProxyPassReverse /api http://127.0.0.1:8000/api

    # WebSocket support (if needed in future)
    # ProxyPass /ws ws://127.0.0.1:8000/ws
    # ProxyPassReverse /ws ws://127.0.0.1:8000/ws

    # Security Headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # CORS Headers (if needed)
    # Header always set Access-Control-Allow-Origin "*"
    # Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    # Header always set Access-Control-Allow-Headers "Content-Type, Authorization"

    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
        AddOutputFilterByType DEFLATE application/javascript application/json
    </IfModule>

    # Cache static assets
    <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "max-age=31536000, public"
    </FilesMatch>
</VirtualHost>

# SSL Configuration (HTTPS)
# Add SSL later with: sudo certbot --apache -d mysurflife.com -d www.mysurflife.com
# Certbot will automatically update this file with HTTPS configuration

